build $git/configure $git/Makefile: download
  url = https://mirrors.kernel.org/pub/software/scm/git/$git.tar.gz

build $git/config.mak.autogen: configure $git/configure | clang make $sysroot/lib/libc.so $sysroot/lib/libz.so $sysroot/lib/libcurl.la
  description = Configuring $git
  prefix = CC=$cc CFLAGS='--sysroot=$sysroot $cflags' LDFLAGS="$ldflags -lz -lbearssl -lcurl -L$$PWD/../out-$bearssl --static"
  opts = --prefix='' ac_cv_c_regex_with_reg_startend=no

build $sysroot/bin/git: make $git/Makefile | $git/config.mak.autogen $sysroot/bin/msgfmt
  description = Building $git
  prefix = DESTDIR=$sysroot
  target = MSGFMT=$sysroot/bin/msgfmt install

build git: phony $sysroot/bin/git
